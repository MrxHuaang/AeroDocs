<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - AeroDocs</title>
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/dashboard.css" />
  </head>
  <body>
    <div id="toast-container"></div>

    <header class="main-header">
      <div class="header-content">
        <div class="logo-container">
          <svg
            class="logo"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
          </svg>
          <span class="logo-text">AERODOCS</span>
        </div>
        <nav class="header-nav">
          <!-- Notifications -->
          <div class="notification-wrapper">
            <button
              id="notification-btn"
              class="icon-btn"
              title="Notifications"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
              </svg>
              <span
                id="notification-badge"
                class="notification-badge"
                style="display: none"
                >0</span
              >
            </button>
            <div id="notification-panel" class="notification-panel">
              <div class="notification-header">
                <h4>Notifications</h4>
                <button id="clear-notifications-btn" class="btn-text">
                  Clear all
                </button>
              </div>
              <div id="notification-list" class="notification-list">
                <p class="no-notifications">No notifications</p>
              </div>
            </div>
          </div>
          <button id="logout-button" class="btn-ghost">Logout</button>
        </nav>
      </div>
    </header>

    <main class="dashboard-container">
      <div class="dashboard-header">
        <h2>Projects</h2>
        <div class="search-and-filters">
          <!-- Search Input -->
          <div class="search-container">
            <svg
              class="search-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input
              type="text"
              id="search-input"
              class="search-input"
              placeholder="Search projects..."
              autocomplete="off"
            />
          </div>
          <div class="filter-controls">
            <button
              id="filter-favorites"
              class="filter-btn"
              title="Show Favorites"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                ></polygon>
              </svg>
            </button>
            <select id="filter-tag" class="filter-select">
              <option value="">All Tags</option>
              <option value="american-airlines">American Airlines</option>
              <option value="latam-airlines">LATAM Airlines</option>
              <option value="united-airlines">United Airlines</option>
              <option value="delta-airlines">Delta Airlines</option>
              <option value="lufthansa">Lufthansa</option>
            </select>
            <select id="sort-order" class="filter-select">
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
            </select>
          </div>
        </div>
        <button id="create-project-btn" class="btn btn-primary">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Create New Project
        </button>
      </div>
      <div id="projects-grid" class="projects-grid">
        <!-- Project cards will be injected here by JavaScript -->
      </div>
    </main>

    <!-- Create Project Modal -->
    <div id="modal-backdrop" class="modal-backdrop"></div>
    <div id="create-project-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Create New Project</h3>
          <button id="close-modal-btn" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="create-project-form">
            <!-- Project Type Selector -->
            <div class="form-group">
              <label for="project-type"
                >Project Type <span class="required">*</span></label
              >
              <select id="project-type" class="form-select" required>
                <option value="">Select type...</option>
                <option value="engine">Engine</option>
                <option value="aircraft">Aircraft</option>
              </select>
            </div>

            <!-- Conditional ESN Field (for Engine) -->
            <div
              id="esn-group"
              class="form-group conditional-field"
              style="display: none"
            >
              <label for="esn-number"
                >ESN (Engine Serial Number)
                <span class="required">*</span></label
              >
              <input type="text" id="esn-number" placeholder="e.g., 1838432" />
            </div>

            <!-- Conditional MSN Field (for Aircraft) -->
            <div
              id="msn-group"
              class="form-group conditional-field"
              style="display: none"
            >
              <label for="msn-number"
                >MSN (Manufacturer's Serial Number)
                <span class="required">*</span></label
              >
              <input type="text" id="msn-number" placeholder="e.g., 2341234" />
            </div>

            <!-- Tags Input (Custom) -->
            <div class="form-group">
              <label>Tags</label>
              <div id="tags-input-container" class="tags-input-container">
                <input
                  type="text"
                  id="tags-input"
                  class="tags-input"
                  placeholder="Type to add tags..."
                  autocomplete="off"
                />
              </div>
              <small class="form-hint"
                >Press Enter to add a tag, type to search or create new</small
              >
            </div>

            <!-- Auto-generated Project Name -->
            <div class="form-group">
              <label for="project-name">Project Name (Auto-generated)</label>
              <input
                type="text"
                id="project-name"
                readonly
                disabled
                class="form-input-readonly"
              />
            </div>

            <div class="form-group">
              <label>Upload Documents</label>
              <div id="drop-zone" class="drop-zone">
                <p>Drag & drop a .zip or .rar file here, or click to select</p>
                <input type="file" id="file-input" accept=".zip,.rar" hidden />
              </div>
            </div>
            <div
              id="upload-progress-container"
              class="upload-progress-container"
              style="display: none"
            >
              <span id="file-name-display"></span>
              <div class="progress-bar">
                <div id="progress-bar-fill" class="progress-bar-fill"></div>
              </div>
            </div>
          </form>
          <div
            id="processing-loader"
            class="processing-loader"
            style="display: none"
          >
            <div class="spinner"></div>
            <div class="processing-loader-content">
              <span id="processing-loader-text">Processing documents...</span>
              <div
                id="processing-loader-progress-wrap"
                class="processing-loader-progress-wrap"
                style="display: none"
              >
                <div class="progress-bar">
                  <div
                    id="processing-loader-progress-fill"
                    class="progress-bar-fill"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancel-modal-btn" class="btn btn-secondary">
            Cancel
          </button>
          <button
            type="submit"
            id="submit-project-btn"
            class="btn btn-primary"
            form="create-project-form"
            disabled
          >
            Start Processing
          </button>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal-backdrop" class="modal-backdrop"></div>
    <div id="delete-modal" class="modal modal-sm">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Delete Project</h3>
          <button id="close-delete-modal-btn" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            Are you sure you want to delete
            <strong id="delete-project-name"></strong>?
          </p>
          <p class="text-muted">This action cannot be undone.</p>
        </div>
        <div class="modal-footer">
          <button id="cancel-delete-btn" class="btn btn-secondary">
            Cancel
          </button>
          <button id="confirm-delete-btn" class="btn btn-danger">Delete</button>
        </div>
      </div>
    </div>

    <!-- Edit Project Modal -->
    <div id="edit-modal-backdrop" class="modal-backdrop"></div>
    <div id="edit-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit Project</h3>
          <button id="close-edit-modal-btn" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <form id="edit-project-form">
            <input type="hidden" id="edit-project-id" />
            <div class="form-group">
              <label for="edit-project-status">Status</label>
              <select id="edit-project-status" class="form-select">
                <option value="PROCESSING">Processing</option>
                <option value="PENDING_REVIEW">Pending Review</option>
                <option value="COMPLETED">Completed</option>
                <option value="FAILED">Failed</option>
              </select>
            </div>
            <div class="form-group">
              <label>Tags</label>
              <div id="edit-tags-input-container" class="tags-input-container">
                <input
                  type="text"
                  id="edit-tags-input"
                  class="tags-input"
                  placeholder="Type to add tags..."
                  autocomplete="off"
                />
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button id="cancel-edit-btn" class="btn btn-secondary">Cancel</button>
          <button id="save-edit-btn" class="btn btn-primary">
            Save Changes
          </button>
        </div>
      </div>
    </div>

    <!-- Processing blocked alert -->
    <div id="processing-blocked-backdrop" class="modal-backdrop"></div>
    <div id="processing-blocked-modal" class="modal modal-sm modal-alert">
      <div class="modal-content">
        <div class="modal-body modal-alert-body">
          <div class="modal-alert-icon processing-icon" aria-hidden="true">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="40"
              height="40"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </div>
          <h3 class="modal-alert-title">Project not ready</h3>
          <p class="modal-alert-message">
            You can not open this project yet, files are being processed.
          </p>
          <button
            id="processing-blocked-ok-btn"
            class="btn btn-primary btn-block"
          >
            OK
          </button>
        </div>
      </div>
    </div>

    <!-- Firebase SDK (compat version for script tags) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script src="js/mock-data.js"></script>
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <!-- Services (Angular-ready architecture) -->
    <script src="js/services/storage.service.js"></script>
    <script src="js/services/firebase.service.js"></script>
    <script src="js/services/projects.service.js"></script>
    <!-- Main page controller -->
    <script src="js/dashboard.js"></script>
  </body>
</html>
