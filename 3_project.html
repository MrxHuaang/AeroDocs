<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project View - AeroDocs</title>
    <!-- Favicon - soporte multi-navegador -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/project.css" />
    <link rel="stylesheet" href="css/validation.css" />
    <!-- jsPDF and AutoTable for PDF Reports -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  </head>
  <body>
    <div id="toast-container"></div>

    <header class="main-header">
      <div class="header-content">
        <div class="logo-container">
          <svg
            class="logo"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
          </svg>
          <a href="2_dashboard.html" class="breadcrumb-link">Projects</a>
          <span class="breadcrumb-separator">/</span>
          <span id="project-name-breadcrumb" class="breadcrumb-current"></span>
        </div>
        <nav class="header-nav">
          <button
            id="export-report-btn"
            class="btn btn-secondary btn-sm"
            title="Export Report"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Export Report
          </button>
          <button id="logout-button" class="btn-ghost">Logout</button>
        </nav>
      </div>
    </header>

    <main class="project-container">
      <!-- Left Panel: Checklist -->
      <div class="checklist-panel">
        <!-- Header -->
        <div class="panel-header">
          <h3>ICAO Checklist</h3>
          <div class="panel-actions">
            <button
              id="toggle-all-btn"
              class="btn-icon"
              title="Expand/Collapse All"
            >
              <svg
                class="toggle-chevron-all"
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="7 13 12 18 17 13"></polyline>
                <polyline points="7 6 12 11 17 6"></polyline>
              </svg>
            </button>
          </div>
        </div>

        <!-- Progress Section -->
        <div class="checklist-progress-section">
          <div class="progress-bar-container">
            <div id="checklist-progress-bar" class="checklist-progress-bar">
              <div
                id="checklist-progress-fill"
                class="checklist-progress-fill"
              ></div>
            </div>
            <span id="checklist-progress-text" class="progress-text">0%</span>
          </div>
          <div id="checklist-summary" class="checklist-summary"></div>
        </div>

        <!-- Search & Filters -->
        <div class="checklist-controls">
          <div class="checklist-search">
            <svg
              class="search-icon"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input
              type="text"
              id="checklist-search"
              placeholder="Search files..."
              autocomplete="off"
            />
          </div>
          <div class="checklist-filters">
            <button
              id="filter-all"
              class="filter-chip active"
              data-filter="all"
            >
              All
            </button>
            <button
              id="filter-present"
              class="filter-chip"
              data-filter="present"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="12"
                height="12"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
              Present
            </button>
            <button
              id="filter-missing"
              class="filter-chip"
              data-filter="missing"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="12"
                height="12"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
              Missing
            </button>
          </div>
        </div>

        <!-- Checklist Content -->
        <div id="checklist-container" class="checklist-tree">
          <!-- Checklist will be rendered here by JavaScript -->
        </div>

        <!-- IATA Validation Dashboard (Collapsible) - At bottom -->
        <div
          id="validation-dashboard"
          class="validation-dashboard collapsed"
          style="display: none"
        >
          <div class="validation-header" id="validation-toggle">
            <h2>
              <svg
                class="toggle-chevron"
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
              IATA STATUS
            </h2>
            <div class="overall-status">
              <span id="overall-percentage" class="overall-percentage">0%</span>
              <span
                id="overall-status-badge"
                class="overall-status-badge status-incomplete"
                >Incomplete</span
              >
            </div>
          </div>
          <div id="validation-content" class="validation-content">
            <div class="validation-inner">
              <div id="sections-grid" class="sections-grid">
                <!-- Section cards will be rendered by JavaScript -->
              </div>
              <div class="section-stats" id="section-stats">
                <!-- Summary stats will be rendered by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Panel: Chatbot -->
      <div class="chat-panel">
        <div class="panel-header">
          <h3>AI Assistant</h3>
          <div class="panel-actions">
            <button id="export-chat-btn" class="btn-icon" title="Export Chat">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </button>
            <button
              id="clear-chat-btn"
              class="btn-icon"
              title="Clear Chat History"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="3 6 5 6 21 6"></polyline>
                <path
                  d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                ></path>
              </svg>
            </button>
          </div>
        </div>
        <div class="chat-window">
          <div id="chat-messages" class="chat-messages">
            <!-- Chat messages will be injected here -->
          </div>
          <div
            id="ai-thinking-indicator"
            class="ai-message"
            style="display: none"
          >
            <div class="message-content">
              <span id="ai-thinking-text" class="thinking-text">Pensando</span>
              <div class="typing-indicator">
                <span></span><span></span><span></span>
              </div>
            </div>
          </div>
        </div>
        <div class="chat-input-area">
          <form id="chat-form" class="chat-form">
            <input
              type="text"
              id="chat-input"
              placeholder="Ask about this project..."
              autocomplete="off"
            />
            <button type="submit" id="send-btn" aria-label="Send Message">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </form>
        </div>
      </div>
    </main>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Firebase SDK (compat version for script tags) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script src="js/mock-data.js"></script>
    <script src="js/main.js"></script>
    <script src="js/auth.js"></script>
    <!-- Services (Angular-ready architecture) -->
    <script src="js/services/storage.service.js"></script>
    <script src="js/services/firebase.service.js"></script>
    <script src="js/services/projects.service.js"></script>
    <script src="js/services/chat.service.js"></script>
    <script src="js/services/checklist.service.js"></script>
    <script src="js/services/export.service.js"></script>
    <!-- IATA Validation -->
    <script src="js/data/iata-documents.js"></script>
    <script src="js/services/validation.service.js"></script>
    <script src="js/services/report.service.js"></script>
    <!-- Main page controller -->
    <script src="js/project.js"></script>
  </body>
</html>
